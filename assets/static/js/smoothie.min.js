/**
 * @license
 * MIT License:
 *
 * Copyright (c) 2010-2013, Joe Walnes
 *               2013-2018, Drew Noakes
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
Date.now=Date.now||function(){return(new Date).getTime()};var Util={extend:function(){arguments[0]=arguments[0]||{};for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&("object"==typeof arguments[t][e]?arguments[t][e]instanceof Array?arguments[0][e]=arguments[t][e]:arguments[0][e]=Util.extend(arguments[0][e],arguments[t][e]):arguments[0][e]=arguments[t][e]);return arguments[0]},binarySearch:function(t,e){for(var i=0,s=t.length;i<s;){var a=i+s>>1;e<t[a][0]?s=a:i=a+1}return i},pixelSnap:function(t,e){return e%2==0?Math.round(t):Math.floor(t)+.5}};function TimeSeries(t){this.options=Util.extend({},TimeSeries.defaultOptions,t),this.disabled=!1,this.clear()}function SmoothieChart(t){this.options=Util.extend({},SmoothieChart.defaultChartOptions,t),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}TimeSeries.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},TimeSeries.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},TimeSeries.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var t=1;t<this.data.length;t++){var e=this.data[t][1];e>this.maxValue&&(this.maxValue=e),e<this.minValue&&(this.minValue=e)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},TimeSeries.prototype.append=function(t,e,i){if(!isNaN(t)&&!isNaN(e)){var s=this.data.length-1;if(s>=0)for(var a=s;;){var o=this.data[a];if(t>=o[0]){t===o[0]?i?(o[1]+=e,e=o[1]):o[1]=e:this.data.splice(a+1,0,[t,e]);break}if(--a<0){this.data.splice(0,0,[t,e]);break}}else this.data.push([t,e]);this.maxValue=isNaN(this.maxValue)?e:Math.max(this.maxValue,e),this.minValue=isNaN(this.minValue)?e:Math.min(this.minValue,e)}},TimeSeries.prototype.dropOldData=function(t,e){for(var i=0;this.data.length-i>=e&&this.data[i+1][0]<t;)i++;0!==i&&this.data.splice(0,i)},SmoothieChart.tooltipFormatter=function(t,e){var i,s=this.options.timestampFormatter||SmoothieChart.timeFormatter,a=document.createElement("div");a.appendChild(document.createTextNode(s(new Date(t))));for(var o=0;o<e.length;++o){""!==(i=e[o].series.options.tooltipLabel||"")&&(i+=" ");var n=document.createElement("span");n.style.color=e[o].series.options.strokeStyle,n.appendChild(document.createTextNode(i+this.options.yMaxFormatter(e[o].value,this.options.labels.precision))),a.appendChild(document.createElement("br")),a.appendChild(n)}return a.innerHTML},SmoothieChart.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(t,e){return parseFloat(t).toFixed(e)},yMaxFormatter:function(t,e){return parseFloat(t).toFixed(e)},yIntermediateFormatter:function(t,e){return parseFloat(t).toFixed(e)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:2,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},title:{text:"",fillStyle:"#ffffff",fontSize:15,fontFamily:"monospace",verticalAlign:"middle"},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:SmoothieChart.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},SmoothieChart.AnimateCompatibility={requestAnimationFrame:function(t,e){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t(Date.now())},16)}).call(window,t,e)},cancelAnimationFrame:function(t){return(window.cancelAnimationFrame||function(t){clearTimeout(t)}).call(window,t)}},SmoothieChart.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff",fillToBottom:!0},SmoothieChart.prototype.addTimeSeries=function(t,e){this.seriesSet.push({timeSeries:t,options:Util.extend({},SmoothieChart.defaultSeriesPresentationOptions,e)}),t.options.resetBounds&&t.options.resetBoundsInterval>0&&(t.resetBoundsTimerId=setInterval(function(){t.resetBounds()},t.options.resetBoundsInterval))},SmoothieChart.prototype.removeTimeSeries=function(t){for(var e=this.seriesSet.length,i=0;i<e;i++)if(this.seriesSet[i].timeSeries===t){this.seriesSet.splice(i,1);break}t.resetBoundsTimerId&&clearInterval(t.resetBoundsTimerId)},SmoothieChart.prototype.getTimeSeriesOptions=function(t){for(var e=this.seriesSet.length,i=0;i<e;i++)if(this.seriesSet[i].timeSeries===t)return this.seriesSet[i].options},SmoothieChart.prototype.bringToFront=function(t){for(var e=this.seriesSet.length,i=0;i<e;i++)if(this.seriesSet[i].timeSeries===t){var s=this.seriesSet.splice(i,1);this.seriesSet.push(s[0]);break}},SmoothieChart.prototype.streamTo=function(t,e){this.canvas=t,this.clientWidth=parseInt(this.canvas.getAttribute("width")),this.clientHeight=parseInt(this.canvas.getAttribute("height")),this.delay=e,this.start()},SmoothieChart.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.pointerEvents="none",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},SmoothieChart.prototype.updateTooltip=function(){if(this.options.tooltip){var t=this.getTooltipEl();if(this.mouseover&&this.options.tooltip){for(var e=this.lastChartTimestamp,i=this.options.scrollBackwards?e-this.mouseX*this.options.millisPerPixel:e-(this.clientWidth-this.mouseX)*this.options.millisPerPixel,s=[],a=0;a<this.seriesSet.length;a++){var o=this.seriesSet[a].timeSeries;if(!o.disabled){var n=Util.binarySearch(o.data,i);n>0&&n<o.data.length&&s.push({series:this.seriesSet[a],index:n,value:o.data[n][1]})}}s.length?(t.innerHTML=this.options.tooltipFormatter.call(this,i,s),t.style.display="block"):t.style.display="none"}else t.style.display="none"}},SmoothieChart.prototype.mousemove=function(t){if(this.mouseover=!0,this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mousePageX=t.pageX,this.mousePageY=t.pageY,this.options.tooltip){var e=this.getTooltipEl();e.style.top=Math.round(this.mousePageY)+"px",e.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()}},SmoothieChart.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},SmoothieChart.prototype.resize=function(){var t,e,i=this.options.enableDpiScaling&&window?window.devicePixelRatio:1;this.options.responsive?(t=this.canvas.offsetWidth,e=this.canvas.offsetHeight,t!==this.lastWidth&&(this.lastWidth=t,this.canvas.setAttribute("width",Math.floor(t*i).toString()),this.canvas.getContext("2d").scale(i,i)),e!==this.lastHeight&&(this.lastHeight=e,this.canvas.setAttribute("height",Math.floor(e*i).toString()),this.canvas.getContext("2d").scale(i,i)),this.clientWidth=t,this.clientHeight=e):(t=parseInt(this.canvas.getAttribute("width")),e=parseInt(this.canvas.getAttribute("height")),1!==i?(Math.floor(this.clientWidth*i)!==t&&(this.canvas.setAttribute("width",Math.floor(t*i).toString()),this.canvas.style.width=t+"px",this.clientWidth=t,this.canvas.getContext("2d").scale(i,i)),Math.floor(this.clientHeight*i)!==e&&(this.canvas.setAttribute("height",Math.floor(e*i).toString()),this.canvas.style.height=e+"px",this.clientHeight=e,this.canvas.getContext("2d").scale(i,i))):(this.clientWidth=t,this.clientHeight=e))},SmoothieChart.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var t=function(){this.frame=SmoothieChart.AnimateCompatibility.requestAnimationFrame(function(){if(this.options.nonRealtimeData){var e=new Date(0),i=this.seriesSet.reduce(function(t,e){var i=e.timeSeries.data,s=Math.round(this.options.displayDataFromPercentile*i.length)-1;if(s=(s=s>=0?s:0)<=i.length-1?s:i.length-1,i&&i.length>0){var a=i[s][0];t=t>a?t:a}return t}.bind(this),e);this.render(this.canvas,i>e?i:null)}else this.render();t()}.bind(this))}.bind(this);t()}},SmoothieChart.prototype.stop=function(){this.frame&&(SmoothieChart.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},SmoothieChart.prototype.updateValueRange=function(){for(var t=this.options,e=Number.NaN,i=Number.NaN,s=0;s<this.seriesSet.length;s++){var a=this.seriesSet[s].timeSeries;a.disabled||(isNaN(a.maxValue)||(e=isNaN(e)?a.maxValue:Math.max(e,a.maxValue)),isNaN(a.minValue)||(i=isNaN(i)?a.minValue:Math.min(i,a.minValue)))}if(null!=t.maxValue?e=t.maxValue:e*=t.maxValueScale,null!=t.minValue?i=t.minValue:i-=Math.abs(i*t.minValueScale-i),this.options.yRangeFunction){var o=this.options.yRangeFunction({min:i,max:e});i=o.min,e=o.max}if(!isNaN(e)&&!isNaN(i)){var n=e-i-this.currentValueRange,r=i-this.currentVisMinValue;this.isAnimatingScale=Math.abs(n)>.1||Math.abs(r)>.1,this.currentValueRange+=t.scaleSmoothing*n,this.currentVisMinValue+=t.scaleSmoothing*r}this.valueRange={min:i,max:e}},SmoothieChart.prototype.render=function(t,e){var i=this.options,s=Date.now();if(!(i.limitFPS>0&&s-this.lastRenderTimeMillis<1e3/i.limitFPS)){if(e=(e||s)-(this.delay||0),e-=e%i.millisPerPixel,!this.isAnimatingScale)if(this.lastChartTimestamp===e)if(!(s-this.lastRenderTimeMillis>1e3/6))return;this.lastRenderTimeMillis=s,this.lastChartTimestamp=e,this.resize();var a=(t=t||this.canvas).getContext("2d"),o={top:0,left:0,width:this.clientWidth,height:this.clientHeight},n=e-o.width*i.millisPerPixel,r=function(t,e){var i=t-this.currentVisMinValue,s=0===this.currentValueRange?o.height:o.height*(1-i/this.currentValueRange);return Util.pixelSnap(s,e)}.bind(this),l=function(t,s){var a=e/i.millisPerPixel-t/i.millisPerPixel,n=i.scrollBackwards?a:o.width-a;return Util.pixelSnap(n,s)};if(this.updateValueRange(),a.font=i.labels.fontSize+"px "+i.labels.fontFamily,a.save(),a.translate(o.left,o.top),a.beginPath(),a.rect(0,0,o.width,o.height),a.clip(),a.save(),a.fillStyle=i.grid.fillStyle,a.clearRect(0,0,o.width,o.height),a.fillRect(0,0,o.width,o.height),a.restore(),a.save(),a.lineWidth=i.grid.lineWidth,a.strokeStyle=i.grid.strokeStyle,i.grid.millisPerLine>0){a.beginPath();for(var h=e-e%i.grid.millisPerLine;h>=n;h-=i.grid.millisPerLine){var m=l(h,i.grid.lineWidth);a.moveTo(m,0),a.lineTo(m,o.height)}a.stroke()}for(var d=1;d<i.grid.verticalSections;d++){var u=Util.pixelSnap(d*o.height/i.grid.verticalSections,i.grid.lineWidth);a.beginPath(),a.moveTo(0,u),a.lineTo(o.width,u),a.stroke()}if(i.grid.borderVisible&&a.strokeRect(0,0,o.width,o.height),a.restore(),i.horizontalLines&&i.horizontalLines.length)for(var c=0;c<i.horizontalLines.length;c++){var p=i.horizontalLines[c],f=p.lineWidth||1,v=r(p.value,f);a.strokeStyle=p.color||"#ffffff",a.lineWidth=f,a.beginPath(),a.moveTo(0,v),a.lineTo(o.width,v),a.stroke()}for(var g=0;g<this.seriesSet.length;g++){var S=this.seriesSet[g].timeSeries,y=S.data;if(S.dropOldData(n,i.maxDataSetLength),!(y.length<=1||S.disabled)){a.save();var x=this.seriesSet[g].options,w=x.strokeStyle&&"none"!==x.strokeStyle,b=w?x.lineWidth:0;a.beginPath();var T,N=l(y[0][0],b),C=r(y[0][1],b),V=N,F=C;switch(a.moveTo(N,C),x.interpolation||i.interpolation){case"linear":case"line":T=function(t,e,i,s){a.lineTo(t,e)};break;case"bezier":default:T=function(t,e,i,s){a.bezierCurveTo(Math.round((i+t)/2),s,Math.round(i+t)/2,e,t,e)};break;case"step":T=function(t,e,i,s){a.lineTo(t,s),a.lineTo(t,e)}}for(var k=1;k<y.length;k++){var P=y[k],M=l(P[0],b),B=r(P[1],b);T(M,B,V,F),V=M,F=B}if(w&&(a.lineWidth=x.lineWidth,a.strokeStyle=x.strokeStyle,a.stroke()),x.fillStyle){var R=x.fillToBottom?o.height+b+1:r(0,0);a.lineTo(V,R),a.lineTo(N,R),a.fillStyle=x.fillStyle,a.fill()}a.restore()}}i.tooltip&&this.mouseX>=0&&(a.lineWidth=i.tooltipLine.lineWidth,a.strokeStyle=i.tooltipLine.strokeStyle,a.beginPath(),a.moveTo(this.mouseX,0),a.lineTo(this.mouseX,o.height),a.stroke()),this.updateTooltip();var A=i.labels;if(!A.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var L=i.yMaxFormatter(this.valueRange.max,A.precision),W=i.yMinFormatter(this.valueRange.min,A.precision),E=i.scrollBackwards?0:o.width-a.measureText(L).width-2,D=i.scrollBackwards?0:o.width-a.measureText(W).width-2;a.fillStyle=A.fillStyle,a.fillText(L,E,A.fontSize),a.fillText(W,D,o.height-2)}if(A.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&i.grid.verticalSections>0){var z=(this.valueRange.max-this.valueRange.min)/i.grid.verticalSections,I=o.height/i.grid.verticalSections;for(d=1;d<i.grid.verticalSections;d++){u=o.height-Math.round(d*I);var H=i.yIntermediateFormatter(this.valueRange.min+d*z,A.precision),X=A.intermediateLabelSameAxis?i.scrollBackwards?0:o.width-a.measureText(H).width-2:i.scrollBackwards?o.width-a.measureText(H).width-2:0;a.fillText(H,X,u-i.grid.lineWidth)}}if(i.timestampFormatter&&i.grid.millisPerLine>0){var O=i.scrollBackwards?a.measureText(W).width:o.width-a.measureText(W).width+4;for(h=e-e%i.grid.millisPerLine;h>=n;h-=i.grid.millisPerLine){m=l(h,0);if(!i.scrollBackwards&&m<O||i.scrollBackwards&&m>O){var U=new Date(h),q=i.timestampFormatter(U),Y=a.measureText(q).width;O=i.scrollBackwards?m+Y+2:m-Y-2,a.fillStyle=i.labels.fillStyle,i.scrollBackwards?a.fillText(q,m,o.height-2):a.fillText(q,m-Y,o.height-2)}}}if(""!==i.title.text){a.font=i.title.fontSize+"px "+i.title.fontFamily;var j=i.scrollBackwards?o.width-a.measureText(i.title.text).width-2:2;if("bottom"==i.title.verticalAlign){a.textBaseline="bottom";var G=o.height}else if("middle"==i.title.verticalAlign){a.textBaseline="middle";G=o.height/2}else{a.textBaseline="top";G=0}a.fillStyle=i.title.fillStyle,a.fillText(i.title.text,j,G)}a.restore()}},SmoothieChart.timeFormatter=function(t){function e(t){return(t<10?"0":"")+t}return e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())};export{TimeSeries,SmoothieChart};